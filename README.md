# Sex-dependent resource defence in the nectar-feeding bat *Glossophaga*

The folder "analysis/data/raw" contains csv files with raw data from full experimental runs of groups of bats inside a labortatory room with ten sugar-water feeders (artifical flowers).
The files were produced by control software PhenoSoft Control v.1.0.5163.31723 (PhenoSys, GmbH).
The folder "analysis/data/metadata" contains input csv files ("masterTable", "conditions", and "bats") necessary for the R scripts that analyze the raw data as well as the csv files produced as output from other scripts.  
The folder "analysis/R" contains R scripts, including a script for reading and aggregating csv files from PhenSoft Control into a single data frame ("load.R") and a script for performing the analysis ("analysis.R"). The output from these scripts are processed csv files, saved in the folder "analysis/data". The output from load.R "EventData.csv" is too big to be uploaded  so it should be generated first, if the other output files generated by analysis.R need to be reproduced. The remaining files are outputs from the analysis.R script.   

## 1. Content of files in /raw subfolder

|Column label |Type     |Information |
|-------------|---------|------------|
|DateTime     |-        |The astronomical date and time for each event of the experiment. Missing nights due to experimental malfunctions, see below|
|IdRFID       |-        |RFID number of animal|
|IdLabel			|-        |Short unique animal identifier|
|unitLabel		|-        |Code of the unit that was activated, with numbers corresponding to the two patches 1-5 patch L and 6-10 patch R|
|             |LS       |Detections of IR-beam interruptions without a transponder number                          detection|
|             |Reader   |Detections of transponder numbers without IR-beam interruptions|
|             |CondMod  |Detections of both a transponder number and an IR-beam                                    interruption (identified visits)|
|             |pumpBeh, Empty, Full| Events relating to states of the syringe and its refilling algorithm|
|             |VersuchCS|Events related to the main program, clarified in **SystemMsg**|
|             |exp      |Events related to the programmed reward schedule, clarified in **SystemMsg**|
|eventDuration|	        |Duration of event in milliseconds (incorrectly overestimated in this program version!)|
|sense1duration|        |Total duration of the IR-beam interruption|
|sense1Events |	        |Number of interruptions of IR beam. When such events happen fast enough (less than 200ms apart) these are registered as a single event, but the number of such short interruptions is given here|
|senseRFIDrecords|    	|Number of times the transponder number was detected; irrelevant for this experiment|
|reinforce1value|		    |Reward (in pump step units, delivered by a stepping motor syringe pump filled with sugar water)|
|reinforce1Total|	      |Contents of this column are irrelevant for this experiment|
|reinforce1Account|	    |Contents of this column are irrelevant for this experiment|
|outFuncLabel |  		    |Contents of this column are irrelevant for this experiment|
|outLabel     |         |Contents of this column are irrelevant for this experiment|
|SystemMsg    |         |System state messages, further clarified in the **unitLabel** column and indicating the beginning or end of, e.g. a preprogrammed reward schedule (no rewards delivered before start and after end of schedule) and beginning or end of syringe refill event (no rewards delivered while refilling). The time of condition change is given with "switch".|
|MsgValue1    |         |Name of parameter file started with the control software|
|MsgValue2    |      		|Contents of this column are irrelevant for this experiment|
|MsgValue3    |         |Contents of this column are irrelevant for this experiment|


## 2. Content of file "EventData.csv"
This file is the output of the load.R script which processes the folder of raw csv files, with further information supplied by "conditions", "mastertable", and "bats" csv files. It is not actually included on the repository due to its large size.

|Column label |	Information|
|-------------|------------|
|night        |Unique number for each experimental night for the full set of data|
|IdLabel		  |Short unique animal identifier|
|loc          |Artificial flower location, given as a number from 1 to 10|
|DateTime	    |Astronomical date and time for each event of the experiment. Missing nights due to experimental malfunctions, see below|
|IdRFID       |RFID number of animal|
|unitLabel		|Code of the unit that was activated, with numbers corresponding to the two patches 1-5 patch L and 6-10 patch R|
|eventDuration|Duration of event in milliseconds|
|SystemMsg	  |Beginning or end of syringe refill event (no rewards delivered while refilling). The time of condition change (from clumped to distributed) is given with "switch".|
|pumping      |The periods when the pump system was busy refilling and no rewards could be delivered are marked as 1|
|phase        |1 for during the clumped condition of the experiment and 2 for the distributed condition|
|vol      	  |Volume (in microliters) of delivered reward|
|rewarded     |1 if a reward was delivered, 0 otherwise|
|group_night  |Experimental night for each group (first true experimental night is 1, negative numbers and 0 for training)|
|weight       |Weight in grams, taken before the beginning of the experiment|
|sex          |"m" for male and "f" for female|
|group        |experimental group, either "6m", "6f", or "mixed1" through "mixed4"|
|cond         |"train" if training (group_night < 1) or "test" if during main experiment|
|choice       |TRUE for CondMod events, FALSE otherwise|


## 3. Content of file "ChaseSummary.csv"
This file is generated by the analysis.R script and contains a summary of chase data for further analysis and graphical representation.

|Column label |	 Information|
|-------------|-------------|
|group_night  |Experimental night for each group (first true experimental night is 1, negative numbers and 0 for training)|
|cond         |"train" if training (group_night < 1) or "test" if during main experiment|
|IdLabel		  |Short unique animal identifier|
|group        |experimental group, either "6m", "6f", or "mixed1" through "mixed4"|
|sex          |"m" for male and "f" for female|
|phase        |1 during the clumped condition of the experiment and 2 during the distributed condition|
|n_detections |Total number of detections of the individual bat|
|n_chases     |Total number of chase events with the individual bat as the chaser|
|prop_chases  |The proportion of chases = n_chases/n_detections|
|n_chased     |Total number of chase events with the individual bat as the chased bat|
|weight       |Weight in grams, taken before the beginning of the experiment|
|glicko_rank  |Glicko rating for each bat in its respective group, based on the last two experimental nights|
|prop_chased  |The proportion of being chased = n_chased/n_detections|

## 4. Content of file "VisitSummary.csv"
This file is generated by the analysis.R script and contains a summary of visit data for further analysis and graphical representation.

|Column label |	 Information|
|-------------|-------------|
|group        |experimental group, either "6m", "6f", or "mixed1" through "mixed4"|
|night        |Unique number for each experimental night for the full set of data|
|group_night  |Experimental night for each group (first true experimental night is 1, negative numbers and 0 for training)|
|IdLabel		  |Short unique animal identifier|
|phase        |1 during the clumped condition of the experiment and 2 during the distributed condition|
|cond         |"train" if training (group_night < 1) or "test" if during main experiment|
|patch        |1 for flowers 1-5 (patch L), 2 for flowers 6-10 (patch R)|
|sex          |"m" for male and "f" for female|
|n            |total number of detections|
|vol_consumed |total volume of sugar water consumed, in mL|
|phase_dur    |duration of phase, in hours|
|vis_hour     |visits per hour (n / phase_dur)|
|ml_hour      |intake per hour (vol_consumed / phase_dur)|

## 5. Content of file "RewardedVisits.csv"
This file is generated by the analysis.R script and contains all rewarded visits further analysis and graphical representation.

|Column label |	 Information|
|-------------|-------------|
|group_night  |Experimental night for each group (first true experimental night is 1, negative numbers and 0 for training)|
|IdLabel		  |Short unique animal identifier|
|status       ||
|group        |experimental group, either "6m", "6f", or "mixed1" through "mixed4"|
|DateTime	    |Astronomical date and time for each event of the experiment|
|loc          |Artificial flower location, given as a number from 1 to 10|
|phase        |1 during the clumped condition of the experiment and 2 during the distributed condition|


## 6. Content of files "mcmcChases.csv" and "mcmcIntakeTime.csv"
These files are generated by the analysis.R script and contain model outputs for quick table representation, without running the slow model from inside the rmd file.

|Column label|	Information|
|------------|-------------|
|term        |term of statistical model|
|estimate    |estimate from the posterior distribution|
|conf.low    |lower credibility bound|
|conf.high   |higher credibility bound|
|eff.samp    |effective sample size|
|pMCMC       |posterior probability for the given term estimate|
|Model       |in file "mcmcChases.csv" gives whether the model is for initiating chases (chasing) or being chased|
|CI          |lower and higher credibility bounds together to form the credibility interval for reporting|

## 7. Content of file "IntakeInteractions.csv"
This file is generated by the analysis.R script and contains model output for quick reference in the text, without running the slow model from inside the rmd file.

|Column label|	Information|
|------------|-------------|
|term        |term of statistical model|
|estimate    |estimate from the posterior distribution|
|conf.low    |lower credibility bound|
|conf.high   |higher credibility bound|


## 8. Content of "metadata/conditions.csv" file
This file is user-generated, providing relevant experimental information not present in the raw files.

|Column label|	Information|
|------------|-------------|
|group_night |Experimental night for each group (first true experimental night is 1, negative numbers and 0 for training)|
|IdLabel		 |Short unique animal identifier|
|IdRFID      |RFID number of animal. Due to occasional lost collars, those may change from day to day and can get reused between groups|
|weight      |Weight in grams, taken before the beginning of the experiment|
|sex         |"m" for male and "f" for female|
|group       |experimental group, either "6m", "6f", or "mixed1" through "mixed4"|
|discard     |0 if there were no issues on that night; 1 if data are to be discarded from analysis completely, otherwise time period given as e.g. ">22:00" removes all data after the time entered|
|cond        |Experimental condition. Before the main experiment ("test"), mice were in a "train" condition, in which all flower visits were rewarded and the two flower patches were not spatially separated|

## 9. Content of "metadata/masterTable.csv" file
This file is user-generated and allows mapping the raw csv files to the respective experimental nights.

|Column label|	Information|
|------------|-------------|
|night       |Unique number for each experimental night for the full set of data|
|path        |Path of the raw csv file corresponding to the night|
|comments	   |Clarifying informaiton, e.g. When nights are omitted|


For further information contact: vladislav.nachev@protonmail.com
